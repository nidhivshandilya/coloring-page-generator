<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Coloring Page Generator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://js.puter.com/v2/"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé® AI Coloring Page Generator</h1>
            <p>Describe what you'd like to color, and AI will create it for you!</p>
        </header>

        <main>
            <div class="input-section">
                <input 
                    type="text" 
                    id="promptInput" 
                    placeholder="e.g., a friendly dragon in a castle"
                    maxlength="200"
                />
                <button id="generateBtn">
                    Generate Coloring Page
                </button>
            </div>

            <div id="loadingSpinner" class="spinner hidden">
                <div class="spinner-circle"></div>
                <p>Creating your coloring page... This may take 20-30 seconds.</p>
            </div>

            <div id="errorMessage" class="error hidden"></div>

            <div id="resultSection" class="result-section hidden">
                <h2>Your Coloring Page</h2>
                <img id="coloringImage" alt="Generated coloring page" />
                <div class="button-group">
                    <button id="downloadBtn">üì• Download</button>
                    <button id="printBtn">üñ®Ô∏è Print</button>
                    <button id="resetBtn">üîÑ Create Another</button>
                </div>
            </div>
        </main>

        <footer>
            <p>Built with Puter AI | 
            <a href="https://github.com/nidhivshandilya/coloring-page-generator" target="_blank">
                View on GitHub
            </a>
            </p>
        </footer>

        <div id="apiKeyModal" class="modal">
            <div class="modal-content">
                <h2>Welcome! üé®</h2>
                <p>This app uses free AI to generate coloring pages!</p>
                <p>No sign-up or API key needed - just click below to start.</p>
                <button id="startBtn">Let's Go!</button>
            </div>
        </div>
    </div>

    <script>
    const API_KEY_STORAGE = 'user_setup_complete';

    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
        
        // Check if setup is complete
        const setupComplete = localStorage.getItem(API_KEY_STORAGE);
        if (!setupComplete) {
            document.getElementById('apiKeyModal').style.display = 'flex';
        } else {
            document.getElementById('apiKeyModal').style.display = 'none';
        }

        // Start button
        document.getElementById('startBtn').addEventListener('click', function() {
            localStorage.setItem(API_KEY_STORAGE, 'true');
            document.getElementById('apiKeyModal').style.display = 'none';
        });

        // Generate button
        document.getElementById('generateBtn').addEventListener('click', generateColoring);

        // Download button
        document.getElementById('downloadBtn').addEventListener('click', downloadImage);

        // Print button
        document.getElementById('printBtn').addEventListener('click', printImage);

        // Reset button
        document.getElementById('resetBtn').addEventListener('click', resetApp);

        // Enter key support
        document.getElementById('promptInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateColoring();
            }
        });
    });

    function generateColoring() {
        // Check if puter is loaded
        if (typeof puter === 'undefined') {
            showError('AI library is still loading. Please wait a moment and try again.');
            return;
        }

        const prompt = document.getElementById('promptInput').value.trim();
        
        if (!prompt) {
            showError('Please describe what you want to color');
            return;
        }
        
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('loadingSpinner').classList.remove('hidden');
        document.getElementById('resultSection').classList.add('hidden');
        document.getElementById('errorMessage').classList.add('hidden');
        
        const coloringPrompt = `${prompt}, simple black and white coloring book page for children, thick outlines, no shading, clean line art`;

        puter.ai.txt2img(coloringPrompt, {
            model: "gpt-image-1-mini",
            quality: "low"
        })
        .then(function(imageElement) {
            const resultImg = document.getElementById('coloringImage');
            resultImg.src = imageElement.src;
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('loadingSpinner').classList.add('hidden');
        })
        .catch(function(error) {
            showError('Error: ' + error.message + '. Please try again.');
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('loadingSpinner').classList.add('hidden');
        });
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.classList.remove('hidden');
    }

    function downloadImage() {
        const img = document.getElementById('coloringImage');
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'coloring-page-' + Date.now() + '.png';
        link.click();
    }

    function printImage() {
        const img = document.getElementById('coloringImage');
        const printWindow = window.open('', '_blank');
        printWindow.document.write('<html><head><title>Print Coloring Page</title><style>@media print { body { margin: 0; } img { max-width: 100%; height: auto; } } body { display: flex; justify-content: center; align-items: center; min-height: 100vh; } img { max-width: 100%; height: auto; }</style></head><body><img src="' + img.src + '" onload="window.print();" /></body></html>');
    }

    function resetApp() {
        document.getElementById('promptInput').value = '';
        document.getElementById('resultSection').classList.add('hidden');
        document.getElementById('errorMessage').classList.add('hidden');
    }
    </script>
</body>
</html>
